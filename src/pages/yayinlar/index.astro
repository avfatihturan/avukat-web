---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import ArticleCard from '../../components/ArticleCard.astro';

const siteEntry = await getEntry('site', 'main');

if (!siteEntry) {
  throw new Error("Site verisi bulunamadı.");
}

const { name } = siteEntry.data;
const allArticles = await getCollection('articles', ({ data }) => !data.draft);
const sortedArticles = allArticles.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout
  title={`Yayınlar ve Makaleler | ${name}`}
  description="Hukuki makaleler, yargıtay kararları ve güncel mevzuat değerlendirmeleri."
  currentPage="yayinlar"
  canonicalUrl="/yayinlar"
>
  <Hero 
    title="Hukuki Yayınlar ve Makaleler" 
    size="sm"
    image="/images/banner-blog.webp"
  />

  <section class="page-section">
    <div class="container">
      <div class="grid-3">
        {sortedArticles.map((article) => (
          <ArticleCard
            title={article.data.title}
            description={article.data.description}
            href={`/yayinlar/${article.slug}`}
            image={article.data.heroImage}
            tag={article.data.tag || ''} 
          />
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .page-section { padding: 4rem 0; background-color: var(--color-bg); }
  .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; }
  
  @media (max-width: 1024px) { .grid-3 { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 768px) { .grid-3 { grid-template-columns: 1fr; } }
</style>