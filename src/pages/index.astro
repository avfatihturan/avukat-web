---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import AreaCard from '../components/AreaCard.astro';
import ArticleCard from '../components/ArticleCard.astro';
import { getEntry, getCollection } from 'astro:content';

// YOL B: Site verisi "site/main"
const siteEntry = await getEntry('site', 'main');

// work-areas hâlâ "data" koleksiyonunda
const workAreasEntry = await getEntry('data', 'work-areas');

// Makaleler
const allArticles = await getCollection('articles', ({ data }) => !data.draft);
const latestArticles = allArticles
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

if (!siteEntry) throw new Error("Site verisi bulunamadı.");

const workAreas = workAreasEntry ? (workAreasEntry.data as any[]) : [];
const { name } = siteEntry.data as any;
---

<BaseLayout
  title={`Ana Sayfa | ${name}`}
  description="Ankara merkezli Ceza, Şirketler, İş ve Kira Hukuku danışmanlığı."
  currentPage="home"
  canonicalUrl="/"
>
  <Hero 
    title="Hukuki Sorunlarınız İçin<br>Profesyonel Çözümler"
    subtitle="AV. FATİH TURAN"
    size="lg" 
    image="/images/banner-home.webp"
  />

  <section class="page-section">
    <div class="container">
      <h2 class="section-heading">Çalışma Alanları</h2>
      
      <div class="grid-layout">
        {workAreas.slice(0, 3).map((area) => (
          <AreaCard
            icon={area.icon}
            title={area.title}
            description={area.description}
            ctaText={area.ctaText}
            ctaLink={area.ctaLink}
          />
        ))}
      </div>

      <div style="text-align: center; margin-top: 40px;">
        <a href="/calisma-alanlari" class="btn">Tüm Alanları İncele</a>
      </div>
    </div>
  </section>

  <section class="page-section bg-light">
    <div class="container">
      <div class="grid-2">
        <div class="about-text">
          <h2 class="section-heading" style="text-align: left; margin-left: 0;">Hakkımda</h2>
          <p class="lead">Hukuki süreçlerinizi şeffaflık ve güven ilkesiyle yönetiyoruz.</p>
          <p>
            Ankara merkezli hukuk büromuzda; Ceza Hukuku, Şirketler Hukuku, İş Hukuku ve Kira Hukuku başta olmak üzere, 
            müvekkillerimize kapsamlı hukuki danışmanlık ve avukatlık hizmeti sunmaktayız. 
            Amacımız, karmaşık hukuki süreçleri müvekkillerimiz için en anlaşılır ve lehe olacak şekilde sonuçlandırmaktır.
          </p>
          <a href="/hakkimda" class="btn-outline-main">Detaylı Bilgi</a>
        </div>
        <div class="about-img-wrapper">
          <div style="background: var(--brand-primary); width: 100%; height: 300px; border-radius: 12px; opacity: 0.1;"></div>
        </div>
      </div>
    </div>
  </section>

  <section class="page-section">
    <div class="container">
      <h2 class="section-heading">Güncel Yayınlar</h2>
      
      <div class="grid-3">
        {latestArticles.map((article) => (
          <ArticleCard
            title={article.data.title}
            description={article.data.description}
            href={`/yayinlar/${article.id}`}
            image={article.data.heroImage}
            tag={article.data.tag || ''}
          />
        ))}
      </div>

      <div style="text-align: center; margin-top: 40px;">
        <a href="/yayinlar" class="btn-outline-main">Tüm Yayınları Oku</a>
      </div>
    </div>
  </section>

</BaseLayout>

<style>
  .page-section { padding: 5rem 0; background-color: var(--color-bg); }
  .bg-light { background-color: var(--color-bg-secondary); }
  
  .grid-layout { display: grid; grid-template-columns: 1fr; gap: 2rem; }
  .grid-2 { display: grid; grid-template-columns: 1fr; gap: 40px; }
  .grid-3 { display: grid; grid-template-columns: 1fr; gap: 30px; }

  .lead { font-size: 1.2rem; font-weight: 500; color: var(--brand-primary); margin-bottom: 20px; }
  html.dark .lead { color: var(--brand-accent); }

  @media (min-width: 768px) { 
    .grid-layout { grid-template-columns: repeat(2, 1fr); } 
    .grid-2 { grid-template-columns: 1.2fr 1fr; align-items: center; }
    .grid-3 { grid-template-columns: repeat(2, 1fr); }
  }
  @media (min-width: 1024px) { 
    .grid-layout { grid-template-columns: repeat(3, 1fr); } 
    .grid-3 { grid-template-columns: repeat(3, 1fr); }
  }
</style>