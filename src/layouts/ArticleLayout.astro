---
import BaseLayout from './BaseLayout.astro';
import TableOfContents from '../components/TableOfContents.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  title: string;
  description: string;

  // Frontmatter'dan string geliyor: "/images/....webp"
  // İleride import edilmiş ImageMetadata da kullanmak istersen destekli
  heroImage: string | ImageMetadata;

  heroAlt: string;
  tag: string;
  pubDate: Date;
  author: string;
  headings: { depth: number; slug: string; text: string }[];
  slug: string;
}

const { title, description, heroImage, heroAlt, tag, pubDate, author, headings, slug } = Astro.props as Props;

// BaseLayout'ta prop adı "image"
const heroImageUrl = typeof heroImage === 'string' ? heroImage : heroImage.src;

// CLS için sabit boyut
const HERO_WIDTH = 800;
const HERO_HEIGHT = 450;
---

<BaseLayout
  title={`${title} | Av. Fatih Turan`}
  description={description}
  currentPage="yayinlar"
  canonicalUrl={`/yayinlar/${slug}`}
  image={heroImageUrl}
>
  <section class="bg-light">
    <div class="container article-container">
      <span class="article-tag">{tag}</span>
      <h1 class="article-title">{title}</h1>

      {typeof heroImage === 'string' ? (
        <img
          src={heroImage}
          alt={heroAlt}
          class="article-hero-img"
          loading="eager"
          decoding="async"
          width={HERO_WIDTH}
          height={HERO_HEIGHT}
        />
      ) : (
        // Eğer ileride src/assets'ten import edersen bu branch devreye girer
        <img
          src={heroImage.src}
          alt={heroAlt}
          class="article-hero-img"
          loading="eager"
          decoding="async"
          width={HERO_WIDTH}
          height={HERO_HEIGHT}
        />
      )}

      <TableOfContents headings={headings} />

      <div class="article-content">
        <slot />
      </div>

      <footer class="author-signature">
        <p><strong>{author}</strong></p>
      </footer>

      <a href="/yayinlar" class="btn-outline-main">&larr; Tüm Yayınlara Dön</a>
    </div>
  </section>
</BaseLayout>

<style is:global>
  .article-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
  .article-title { text-align: left; line-height: 1.3; margin: 15px 0 30px; font-size: 2rem; color: var(--brand-primary); }
  html.dark .article-title { color: var(--color-text); }
  .article-hero-img { width: 100%; height: auto; border-radius: 8px; margin-bottom: 40px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
  .article-content { font-size: 1.05rem; line-height: 1.8; color: var(--color-text); }
  .article-content h2 { margin: 40px 0 20px; color: var(--brand-primary); font-size: 1.5rem; }
  html.dark .article-content h2 { color: var(--color-text); }
  .article-content h3 { margin: 30px 0 15px; color: var(--brand-primary); font-size: 1.25rem; }
  html.dark .article-content h3 { color: var(--color-text); }
  .article-content p { margin-bottom: 20px; }
  .article-content ul, .article-content ol { margin-bottom: 20px; padding-left: 25px; }
  .article-content li { margin-bottom: 10px; }
  .article-content blockquote { background: var(--color-bg-secondary); padding: 15px; border-left: 4px solid var(--brand-accent); margin: 20px 0; font-style: normal; }
  .article-content a { color: var(--brand-accent); text-decoration: underline; }
  .article-content a:hover { color: var(--brand-primary); }
  html.dark .article-content a:hover { color: var(--color-text); }
  .author-signature { margin-top: 60px; padding-top: 30px; border-top: 1px solid var(--color-border); }
  .author-signature p { color: var(--color-text); font-size: 1rem; line-height: 1.6; }
  .author-signature strong { color: var(--brand-primary); }
  html.dark .author-signature strong { color: var(--color-text); }
  .btn-outline-main { display: inline-block; margin-top: 30px; padding: 12px 24px; border: 2px solid var(--brand-primary); color: var(--brand-primary); text-decoration: none; border-radius: 4px; font-weight: 600; transition: all 0.3s ease; }
  html.dark .btn-outline-main { border-color: var(--color-text); color: var(--color-text); }
  .btn-outline-main:hover { background: var(--brand-primary); color: #fff; }
  html.dark .btn-outline-main:hover { background: var(--color-text); color: var(--color-bg); }
</style>